<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tetris Prize Challenge</title>
  <style>
    :root{--bg:#0b1220;--panel:#0f1724;--accent:#8be9fd;--muted:#9aa6b2}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:linear-gradient(180deg,#071129 0%,#081226 60%);color:#e6eef6;display:flex;align-items:center;justify-content:center;padding:24px}
    .wrap{display:flex;gap:28px;align-items:flex-start}
    .panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    .left{display:flex;flex-direction:column;align-items:center}
    canvas{background:#071129;border-radius:8px;display:block}
    .hud{margin-top:12px;display:flex;gap:12px}
    .stat{background:rgba(255,255,255,0.02);padding:8px 12px;border-radius:8px;text-align:center}
    .small{font-size:12px;color:var(--muted)}
    button{background:var(--accent);border:none;padding:8px 12px;border-radius:8px;color:#06121a;font-weight:600;cursor:pointer}
    .right{width:260px}
    h1{margin:0 0 8px 0;font-size:20px}
    p{margin:6px 0 12px 0;color:var(--muted);font-size:13px}
    .controls{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .control{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px}
    .footer{font-size:12px;color:var(--muted);margin-top:10px}
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center}
    .modal{background:var(--panel);padding:18px;border-radius:12px;max-width:420px;width:92%;box-shadow:0 10px 40px rgba(2,6,23,0.7)}
    .modal.show{display:block}
    .win-badge{font-size:18px;color:#06121a;background:#a6f4c5;padding:6px 10px;border-radius:999px;display:inline-block;margin-bottom:8px}
    @media(max-width:820px){body{padding:12px}.wrap{flex-direction:column;align-items:center}.right{width:100%}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel left">
      <canvas id="game" width="300" height="600"></canvas>
      <div class="hud">
        <div class="stat"><div class="small">Score</div><div id="score">0</div></div>
        <div class="stat"><div class="small">Lines</div><div id="lines">0</div></div>
        <div class="stat"><div class="small">Level</div><div id="level">1</div></div>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
        <button id="startBtn">Start / Restart</button>
        <button id="pauseBtn">Pause</button>
      </div>
    </div>

    <div class="panel right">
      <h1>Tetris Prize Challenge</h1>
      <p>Clear <strong id="winLinesText">10</strong> lines to unlock the prize!</p>

      <div class="controls">
        <div class="control">
          <div class="small">Goal</div>
          <div id="goal">Clear 10 lines</div>
        </div>
        <div class="control">
          <div class="small">Status</div>
          <div id="status">Ready</div>
        </div>
      </div>

      <p class="footer">Prize unlocks automatically after winning.</p>
    </div>
  </div>

  <div id="modal" class="modal-backdrop">
    <div class="modal">
      <div class="win-badge">You Won!</div>
      <h2>Congratulations â€” Prize Unlocked ðŸŽ‰</h2>
      <p>Your prize is ready!</p>
      <div style="margin-top:12px;display:flex;gap:8px">
        <button id="openPrize">Open Prize</button>
      </div>
    </div>
  </div>

  <script>
    // Fixed Prize Link
    const PRIZE_LINK = "https://drive.google.com/file/d/1drk9tt4fSFeYoK0IbczhLP-RW0G4pYSe/view?usp=sharing";
    const WIN_LINES = 10;

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scale = 30;
    const cols = 10;
    const rows = 20;

    canvas.width = cols * scale;
    canvas.height = rows * scale;

    const scoreEl = document.getElementById('score');
    const linesEl = document.getElementById('lines');
    const levelEl = document.getElementById('level');
    const statusEl = document.getElementById('status');

    const modalBackdrop = document.getElementById('modal');
    const openPrizeBtn = document.getElementById('openPrize');

    openPrizeBtn.addEventListener('click', () => {
      window.open(PRIZE_LINK, "_blank");
    });

    function showModal(){ modalBackdrop.style.display = "flex"; }

    let grid = createMatrix(cols, rows);
    let current = null;
    let dropCounter = 0;
    let dropInterval = 800;
    let lastTime = 0;
    let score = 0;
    let lines = 0;
    let level = 1;
    let running = false;

    const tetrominoes = {
      I: [[1,1,1,1]],
      J: [[2,0,0],[2,2,2]],
      L: [[0,0,3],[3,3,3]],
      O: [[4,4],[4,4]],
      S: [[0,5,5],[5,5,0]],
      T: [[0,6,0],[6,6,6]],
      Z: [[7,7,0],[0,7,7]]
    };

    const colors = [null,"#00f0f0","#0000f0","#f0a000","#f0f000","#00f000","#a000f0","#f00000"];

    function createMatrix(w, h){
      const m = [];
      for(let y=0; y<h; y++) m.push(new Array(w).fill(0));
      return m;
    }

    function createPiece(type){
      return tetrominoes[type].map(r => r.slice());
    }

    function collide(grid, piece, offset){
      for(let y=0; y<piece.length; y++){
        for(let x=0; x<piece[y].length; x++){
          if(piece[y][x] !== 0 &&
            (grid[y+offset.y] && grid[y+offset.y][x+offset.x]) !== 0){
            return true;
          }
        }
      }
      return false;
    }

    function merge(grid, piece, offset){
      for(let y=0; y<piece.length; y++){
        for(let x=0; x<piece[y].length; x++){
          if(piece[y][x] !== 0){
            grid[y+offset.y][x+offset.x] = piece[y][x];
          }
        }
      }
    }

    function rotate(matrix, dir){
      for(let y=0;y<matrix.length;y++){
        for(let x=0;x<y;x++){
          [matrix[x][y],matrix[y][x]] = [matrix[y][x],matrix[x][y]];
        }
      }
      if(dir>0) matrix.forEach(r=>r.reverse());
      else matrix.reverse();
    }

    function playerDrop(){
      current.pos.y++;
      if(collide(grid,current.matrix,current.pos)){
        current.pos.y--;
        merge(grid,current.matrix,current.pos);
        sweepLines();
        spawnPiece();
        if(collide(grid,current.matrix,current.pos)){
          running = false;
          statusEl.textContent = "Game Over";
        }
      }
      dropCounter = 0;
    }

    function sweepLines(){
      let rowCount = 0;
      outer: for(let y=grid.length-1; y>=0; y--){
        for(let x=0; x<grid[y].length; x++){
          if(grid[y][x] === 0) continue outer;
        }
        grid.splice(y,1);
        grid.unshift(new Array(cols).fill(0));
        y++;
        rowCount++;
      }

      if(rowCount > 0){
        lines += rowCount;

        if(lines >= WIN_LINES){
          running = false;
          statusEl.textContent = "You Win!";
          showModal();
        }

        score += rowCount * 100;
        updateHUD();
      }
    }

    function spawnPiece(){
      const types = "IJLOSTZ";
      const t = types[Math.floor(Math.random()*types.length)];
      current = {
        matrix: createPiece(t),
        pos: { x: Math.floor(cols/2)-1, y: 0 }
      };
    }

    function updateHUD(){
      scoreEl.textContent = score;
      linesEl.textContent = lines;
      levelEl.textContent = level;
    }

    function draw(){
      ctx.fillStyle = "#071129";
      ctx.fillRect(0,0,canvas.width,canvas.height);

      for(let y=0; y<rows; y++){
        for(let x=0; x<cols; x++){
          const val = grid[y][x];
          if(val){
            ctx.fillStyle = colors[val];
            ctx.fillRect(x*scale,y*scale,scale-1,scale-1);
          }
        }
      }

      if(current){
        for(let y=0; y<current.matrix.length; y++){
          for(let x=0; x<current.matrix[y].length; x++){
            const val = current.matrix[y][x];
            if(val){
              ctx.fillStyle = colors[val];
              ctx.fillRect((current.pos.x+x)*scale,(current.pos.y+y)*scale,scale-1,scale-1);
            }
          }
        }
      }
    }

    function update(time=0){
      if(!running) return;
      const delta = time - lastTime;
      lastTime = time;
      dropCounter += delta;

      if(dropCounter > dropInterval) playerDrop();

      draw();
      requestAnimationFrame(update);
    }

    // input
    document.addEventListener("keydown", e=>{
      if(!running) return;
      if(e.key === "ArrowLeft") current.pos.x--;
      if(e.key === "ArrowRight") current.pos.x++;
      if(e.key === "ArrowDown") playerDrop();
      if(e.code === "Space") { e.preventDefault(); while(!collide(grid,current.matrix,{x:current.pos.x,y:current.pos.y+1})) current.pos.y++; playerDrop(); }
      if(e.key === "ArrowUp") rotate(current.matrix,1);
      draw();
    });

    document.getElementById("startBtn").addEventListener("click", ()=>{
      grid = createMatrix(cols, rows);
      score = 0; lines = 0; level = 1;
      updateHUD();
      spawnPiece();
      running = true;
      statusEl.textContent = "Playing";
      lastTime = 0;
      requestAnimationFrame(update);
    });

    document.getElementById("pauseBtn").addEventListener("click", ()=>{
      running = !running;
      statusEl.textContent = running ? "Playing" : "Paused";
      if(running) requestAnimationFrame(update);
    });

    spawnPiece();
    updateHUD();
  </script>
</body>
</html>
